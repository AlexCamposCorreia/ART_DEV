    Sub GetMeteoFileName(ByVal Model As Model, ByRef MeteoFile As String, ByVal MeteoSolutionIndex As Integer, Optional ByVal extension As String = ".hdf5")
        Dim MeteoFinalDateStr As String
        Dim MeteoModelName As String
        Dim MeteoFileSuffix As String
        Dim M       eteoFileName_fromModel As Boolean
        Dim MeteoSimulatedDays As Integer
        Dim MeteoWorkPath As String
        Dim MeteoGenericFilename As Boolean

        Select Case MeteoSolutionIndex
            Case 1
                MeteoFileName_fromModel = Model.MeteoFileName_fromModel
                MeteoModelName = Model.MeteoModelName
                MeteoWorkPath = Model.MeteoWorkPath
                MeteoSimulatedDays = Model.MeteoSimulatedDays
                MeteoGenericFilename = Model.MeteoGenericFileName
            Case 2
                MeteoFileName_fromModel = Model.Meteo2FileName_fromModel
                MeteoModelName = Model.Meteo2ModelName
                MeteoWorkPath = Model.Meteo2WorkPath
                MeteoSimulatedDays = Model.Meteo2SimulatedDays
                MeteoGenericFilename = Model.Meteo2GenericFileName
            Case 3
                MeteoFileName_fromModel = Model.Meteo3FileName_fromModel
                MeteoModelName = Model.Meteo3ModelName
                MeteoWorkPath = Model.Meteo3WorkPath
                MeteoSimulatedDays = Model.Meteo3SimulatedDays
                MeteoGenericFilename = Model.Meteo3GenericFileName
        End Select
        If MeteoFileName_fromModel = True Then
            MeteoFileSuffix = Model.Name
        Else
            MeteoFileSuffix = "Tagus3D"
        End If
        'If MeteoModelName = "" Then
        '    If InStr(MeteoWorkPath, "WRF") > 0 Then
        '        MeteoModelName = "WRF"
        '    ElseIf InStr(MeteoWorkPath, "MM5") > 0 Then
        '        MeteoModelName = "MM5"
        '    ElseIf InStr(MeteoWorkPath, "GFS") > 0 Then
        '        MeteoModelName = "GFS"
        '    End If
        'End If

        ' if METEO_SIMULATED_DAYS is not defined (assuming the default value of -99, then final date will be FinalDateStr 
        If MeteoSimulatedDays = -99 Then
            MeteoFinalDateStr = FinalDateStr
        Else
            MeteoFinalDateStr = InitialDate.AddDays(MeteoSimulatedDays).ToString("yyyy-MM-dd")
        End If

        If MeteoFileName_fromModel = False And MeteoGenericFilename = True Then
            MeteoFile = Path.Combine(MeteoWorkPath, "meteo" + "_" + InitialDateStr + "_" + MeteoFinalDateStr + extension)
        Else
            MeteoFile = Path.Combine(MeteoWorkPath, MeteoModelName + "_" + MeteoFileSuffix + "_" + InitialDateStr + "_" + MeteoFinalDateStr + extension)
        End If

    End Sub